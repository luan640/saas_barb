<!-- head -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- ... -->

<body>
  {% block content %}{% endblock %}

  <!-- Modal global (reaproveitado para qualquer CRUD) -->
  <div class="modal fade" id="appModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content" id="appModalContent">
        <!-- conteúdo é carregado via HTMX -->
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>

  <script>
    // Abre o modal quando um fragmento for injetado no #appModalContent
    document.body.addEventListener('htmx:afterSwap', (e) => {
      if (e.detail.target && e.detail.target.id === 'appModalContent') {
        const modalEl = document.getElementById('appModal');
        const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
        modal.show();
      }
    });

    // Fecha modal quando o servidor sinaliza
    document.body.addEventListener('htmx:afterOnLoad', (e) => {
      const trigger = e.detail.xhr.getResponseHeader('HX-Trigger');
      if (trigger && trigger.includes('closeModal')) {
        const modalEl = document.getElementById('appModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        modal && modal.hide();
        // opcional: limpa conteúdo
        document.getElementById('appModalContent').innerHTML = '';
      }
    });
  </script>
</body>
